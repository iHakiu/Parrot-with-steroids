# ~/.config/picom/picom.conf
# Sintaxis moderna con rules: — compatible con picom v12.5 y preparada para v13
# Evita todas las opciones marcadas como "discouraged" en la documentación oficial

# ─── Backend de renderizado ───────────────────────────────────────────────────
# glx  = usa la GPU, mejor rendimiento y calidad
# xrender = más compatible, usar si hay artefactos visuales en VM
backend = "glx";

# vsync evita el tearing (imagen partida en scroll o movimiento)
vsync = true;

# Solo redibuja zonas de pantalla que realmente cambiaron — mejor rendimiento
use-damage = true;

# Nivel de log — "warn" = solo advertencias, sin spam en consola
log-level = "warn";

# ─── Esquinas redondeadas ─────────────────────────────────────────────────────
# Radio global — las excepciones (dock, desktop) van en rules:
corner-radius = 10;

# ─── Sombras ──────────────────────────────────────────────────────────────────
shadow = true;
shadow-radius = 12;
shadow-opacity = 0.75;
shadow-offset-x = -12;
shadow-offset-y = -12;

# ─── Blur de fondo ────────────────────────────────────────────────────────────
# dual_kawase = mejor algoritmo disponible, suave y eficiente en GPU
# Crea el efecto "frosted glass" sobre las ventanas transparentes (kitty)
# strength: 1 (sutil) — 20 (muy intenso)
blur: {
    method = "dual_kawase";
    strength = 5;
    background = true;
    background-frame = true;
    background-fixed = true;
}

# ─── Fade ─────────────────────────────────────────────────────────────────────
# Fade nativo — las ventanas aparecen y desaparecen suavemente
# NOTA: Los presets animados (zoom, fly-in, slide...) requieren el fork
#       FT-Labs/picom — no disponibles en el picom estándar de Parrot/Debian
fading = true;
fade-in-step  = 0.03;    # más bajo = más lento y suave
fade-out-step = 0.03;
fade-delta    = 5;        # milisegundos entre cada paso

# ─── Detección ────────────────────────────────────────────────────────────────
detect-rounded-corners = true;
detect-client-opacity  = true;

# ─── Reglas por ventana — sintaxis unificada (v12.5+, recomendada para v13) ──
# Sustituye las opciones antiguas: shadow-exclude, blur-background-exclude,
# opacity-rule, focus-exclude, rounded-corners-exclude, wintypes, active-opacity,
# inactive-opacity, mark-wmwin-focused, mark-ovredir-focused
#
# Las reglas se evalúan en orden — la última que coincide tiene prioridad
rules = (
    # ── Ventana enfocada — siempre completamente opaca
    {
        match = "focused";
        opacity = 1.0;
    },
    # ── Ventanas sin foco — ligeramente transparentes
    {
        match = "!focused";
        opacity = 0.95;
    },

    # ── Polybar — sin sombra, sin esquinas, opaco, sin blur
    {
        match = "class_g = 'Polybar'";
        shadow        = false;
        opacity       = 1.0;
        blur-background = false;
    },
    # ── Fondo de escritorio — sin esquinas, sin blur
    {
        match = "window_type = 'desktop'";
        corner-radius   = 0;
        blur-background = false;
    },
    # ── Dock (barra de tareas) — sin sombra, sin blur
    {
        match = "window_type = 'dock'";
        shadow          = false;
        blur-background = false;
    },
    # ── Drag-and-drop — sin sombra
    {
        match = "window_type = 'dnd'";
        shadow = false;
    },
    # ── Tooltips — con fade, con sombra, semitransparente
    {
        match       = "window_type = 'tooltip'";
        fade        = true;
        shadow      = true;
        opacity     = 0.95;
        full-shadow = false;
    },
    # ── Menús desplegables — sin blur, ligeramente transparentes
    {
        match           = "window_type = 'popup_menu' || window_type = 'dropdown_menu'";
        opacity         = 0.95;
        blur-background = false;
    },
    # ── Notificaciones — sin sombra
    {
        match  = "name = 'Notification' || class_g = 'Conky' || "
                 "class_g ?= 'Notify-osd' || class_g = 'Cairo-clock'";
        shadow = false;
    },
    # ── slop (herramienta de selección de área de pantalla) — sin interferencia
    {
        match           = "class_g = 'slop'";
        shadow          = false;
        opacity         = 1.0;
        blur-background = false;
    },
    # ── Kitty — gestiona su propia transparencia desde kitty.conf
    #    picom solo aplica el blur detrás, no toca la opacidad
    {
        match   = "class_g = 'kitty'";
        opacity = 1.0;
    },
    # ── Firefox — siempre opaco
    {
        match   = "class_g = 'firefox'";
        opacity = 1.0;
    },
    # ── VSCode — ligeramente transparente
    {
        match   = "class_g = 'Code'";
        opacity = 0.95;
    },
    # ── Thunar (gestor de archivos) — opaco
    {
        match   = "class_g = 'Thunar'";
        opacity = 1.0;
    },
);
